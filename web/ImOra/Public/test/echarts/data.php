<?php
$str = '{
  "results": [
    {
      "columns": [
        "q"
      ],
      "data": [
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14623,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "20221",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "路凯",
                  "userid": "ArvgE6kOiwu6ip8PrUBtDdINmXhNo00000000830"
                }
              }
            ],
            "relationships": [
              {
                "id": "14623",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "20221",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14622,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "19776",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "Justin",
                  "userid": "AqPaxjkxYz2bPv1n1oqZVJCYfwu4I00000008688"
                }
              },
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              }
            ],
            "relationships": [
              {
                "id": "14622",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "19776",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14621,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "19298",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "CHarles ZH",
                  "userid": "ApDyxkzaxDbblvAf7jJ9E3CYYbt5q00000001503"
                }
              }
            ],
            "relationships": [
              {
                "id": "14621",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "19298",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14620,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "18862",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王喆",
                  "userid": "AO9uRiVzxwPPxTlGTmS7onMch5iWg00000000797"
                }
              }
            ],
            "relationships": [
              {
                "id": "14620",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "18862",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14619,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "18755",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "39101",
                  "userid": "ANuZxQMFSiOTr0o57c1dMtnaOxXXq00000019846"
                }
              }
            ],
            "relationships": [
              {
                "id": "14619",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "18755",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14618,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "16951",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "Thomas",
                  "userid": "Aj6IpGh7ACBWUKOz2ObHw6EuHqb7a00000008687"
                }
              }
            ],
            "relationships": [
              {
                "id": "14618",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "16951",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14617,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "15312",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "崔琦",
                  "userid": "AeRkWWn27xjbOa5cNNo5457PrfnR600000000804"
                }
              },
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              }
            ],
            "relationships": [
              {
                "id": "14617",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "15312",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14616,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "14839",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "相知相守",
                  "userid": "ADGwejBjg7MCHFvXkLKRbvjkGAvmG00000000768"
                }
              }
            ],
            "relationships": [
              {
                "id": "14616",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "14839",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14615,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "13980",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "蔡蓉",
                  "userid": "AB6K15DgluQ5OAmwRMNCO5B61lcUw00000000827"
                }
              }
            ],
            "relationships": [
              {
                "id": "14615",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "13980",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14613,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "12886",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "Mary",
                  "userid": "A69vDLwcS5YXEi8umL0B9eheCB7hX00000008686"
                }
              }
            ],
            "relationships": [
              {
                "id": "14613",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "12886",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14612,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "12666",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "崔琦",
                  "userid": "A4Z5UP279dnWWroTFliZCXnf2J4Pr00000000804"
                }
              }
            ],
            "relationships": [
              {
                "id": "14612",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "12666",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14611,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "11829",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "COCO在线",
                  "userid": "A0MamBXtNHo013cb5AqqSQHJztSHz00000009061"
                }
              }
            ],
            "relationships": [
              {
                "id": "14611",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "11829",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14628,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "22794",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "胡承群",
                  "userid": "AyR4cf2mHhJ3A1VqFIx6ZQ86h0Nvf00000000798"
                }
              }
            ],
            "relationships": [
              {
                "id": "14628",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "22794",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14624,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "20803",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "ma8401",
                  "userid": "AteqY6CkOCNVmnQ17DNS34tR3uMzx00000000775"
                }
              }
            ],
            "relationships": [
              {
                "id": "14624",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "20803",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14625,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "22114",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "Jason",
                  "userid": "AwVsYzw0qMfpkO3TM6j7STcUkLWRO00000008684"
                }
              }
            ],
            "relationships": [
              {
                "id": "14625",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "22114",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14626,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "22277",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "杜潜",
                  "userid": "AXEeU08pona2csv4FvqBCiYF605Qf00000004366"
                }
              }
            ],
            "relationships": [
              {
                "id": "14626",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "22277",
                "properties": {}
              }
            ]
          }
        },
        {
          "row": [
            {}
          ],
          "meta": [
            {
              "id": 14627,
              "type": "relationship",
              "deleted": false
            }
          ],
          "graph": {
            "nodes": [
              {
                "id": "11825",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "王存平",
                  "userid": "A0lhg8hmfqHBzUhCoCYn6pSMba72C00000000752"
                }
              },
              {
                "id": "22618",
                "labels": [
                  "User"
                ],
                "properties": {
                  "name": "田建林PHP",
                  "userid": "AYcjhx1QeKsVnxn41orehpKo7RrCr00000001196"
                }
              }
            ],
            "relationships": [
              {
                "id": "14627",
                "type": "Friend",
                "startNode": "11825",
                "endNode": "22618",
                "properties": {}
              }
            ]
          }
        }
      ],
      "stats": {
        "contains_updates": false,
        "nodes_created": 0,
        "nodes_deleted": 0,
        "properties_set": 0,
        "relationships_created": 0,
        "relationship_deleted": 0,
        "labels_added": 0,
        "labels_removed": 0,
        "indexes_added": 0,
        "indexes_removed": 0,
        "constraints_added": 0,
        "constraints_removed": 0
      }
    }
  ],
  "errors": [],
  "responseTime": 25
}';
$str = json_decode($str,true);
$arr = $str['results'][0]['data'];
$nodes = $links = array();
foreach ($arr as $v){
	$nodeArr = $lineArr = array();
	if($v['meta'][0]['deleted'] === false){
		$nodeArr = $v['graph']['nodes'];
		$linkArr = $v['graph']['relationships'];
	}
	foreach ($nodeArr as $nodeV){
		$nodes[$nodeV['id']] = array('id'=>$nodeV['properties']['userid'],'name'=>$nodeV['properties']['name']);
	}
	foreach ($linkArr as $linkV){
		$links[] = array('start'=>$linkV['startNode'],'end'=>$linkV['endNode'],'name'=>$linkV['type']);
	}
}
$jsnode = $jslink = array();
foreach ($nodes as $k=>$v){
	$jsnode[] = array('category'=>1, 'name'=>$v['name'],'value'=>50,'draggable'=>true);
}
$jsnode[0]['category'] = 0;
$jsnode[0]['draggable'] = true;
$jsnode[0]['symbol'] = 'image://http://www.damndigital.com/wp-content/uploads/2010/12/steve-jobs.jpg';
$jsnode[0]['symbolSize'] = [60, 35];
$jsnode[0]['itemStyle'] =array('normal'=>array(
                            'label'=>array('position'=> 'right','textStyle'=>array('color'=>'black'))));
                               
$jsnode[15]['category'] = 2;
$jsnode[16]['category'] = 2;
foreach ($links as $k=>$v){
	$jslink[] = array('source'=>$nodes[$v['start']]['name'], 'target'=> $nodes[$v['end']]['name'], 'weight'=>50, 'name'=>$v['name']);
}
?>